<!DOCTYPE html>
<html class="html">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"/>
        <title>Lamina</title>
        <link rel="stylesheet" type="text/css" href="loginform.css">
        <link rel="stylesheet" type="text/css" href="/bootstrap-3.3.7-dist/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="bootstrap.css">
        <link href="https://fonts.googleapis.com/css?family=Rajdhani:300" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
        <script src="https://code.jquery.com/jquery-migrate-3.0.0.js"></script>
         <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.css' rel='stylesheet' />
        <script src="currentMap.js"></script>
        
        <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
    </head>
    <body class="body">

        <div class="map" id ="map">
                <script>
                    var gps = JSON.parse(window.localStorage.getItem("coordinates"));  
                    console.log("§§§§§§§§§§§§§§§§§§§§§§§§§");
                    console.log(gps[0]);
                    var coordinate_array;

    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2FybDk0IiwiYSI6ImNpeTVucXc5YzAwNG0ycW82MTFqeWl5bmQifQ.L3m2Ue3OOucOI3XrhwjUIQ';
                    var map = new mapboxgl.Map({
                        container: 'map', // container id
                        style: 'mapbox://styles/mapbox/satellite-v9', //stylesheet location
                        center: [-6.934135900000001,52.8365072], // starting position longitude followed by latitude
                        zoom: 5 // starting zoom
                    });


    map.on('load', function () {
        var i = 0; 
        var outer_loop = 0;
        var id_value =0;
        //TODO seperate out each array of coordinates
        
        //console.log("Separated:  "+ separated_coordinates);
        //need to loop through splices
        while(outer_loop != gps.length)
            {
                
                var separated_coordinates = gps.splice(outer_loop,outer_loop+4);
                //console.log("outerloop start: " + outer_loop);
       
                /*console.log(separated_coordinates[0]);
                console.log(separated_coordinates[1]);
                console.log(separated_coordinates[2]);
                console.log(separated_coordinates[3]);
                console.log("i:  " + i);*/
                
                
                            id_value= id_value = parseInt(Math.floor((Math.random() * 10000) + 1)).toString();
                            console.log(id_value);
                            map.addLayer({
                                "id": id_value,
                                "type": "symbol",
                                "source": {
                                    "type": "geojson",
                                    "data": {
                                        "type": "FeatureCollection",
                                        "features": [{
                                            "type": "Feature",
                                            "geometry": {
                                                "type": "Point",
                                                "cluster":true,
                                                "coordinates": [parseFloat(separated_coordinates[i]),parseFloat(separated_coordinates[i+1])]
                                            },
                                            "properties": {
                                                "title": separated_coordinates[i+2],
                                                "icon": "dog-park"

                                            }
                                        }]
                                    }
                                },
                                "layout": {
                                    "icon-image": "{icon}-15",
                                    "text-field": "{title}",
                                    "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                                    "text-offset": [0, 0.6],
                                    "text-anchor": "top"
                                }
                            });
                                //i = 4;
                                //console.log("i:  " + i);
                                id_value = 0;
            
                
            console.log("outerloop: " + outer_loop);
        }
         
    });
    
                   
                    
                   
                   
                </script>
          
        </div>    
    </body>
</html>