<!DOCTYPE html>
<html class="html">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width"/>
        <title>Lamina</title>
        <link rel="stylesheet" type="text/css" href="loginform.css">
        <link rel="stylesheet" type="text/css" href="/bootstrap-3.3.7-dist/css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="bootstrap.css">
        <link href="https://fonts.googleapis.com/css?family=Rajdhani:300" rel="stylesheet">
        <script src="https://code.jquery.com/jquery-3.0.0.js"></script>
        <script src="https://code.jquery.com/jquery-migrate-3.0.0.js"></script>
         <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.31.0/mapbox-gl.css' rel='stylesheet' />
        <script type="text/javascript" src="backButton.js"></script>
        <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
        
        <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
    </head>
    <body class="body" onload="onLoad()">

        <div class="map" id ="map">
                <script>
                    var the_gps =JSON.parse(window.localStorage.getItem("analyse_coordinates"));
                    var coordinate_array = Object.values(the_gps);

                     console.log("coordinate_array: " + coordinate_array);
                    var temp_start = coordinate_array[0];
                    var start_coordinates = Object.values(temp_start);

    mapboxgl.accessToken = 'pk.eyJ1IjoiZ2FybDk0IiwiYSI6ImNpeTVucXc5YzAwNG0ycW82MTFqeWl5bmQifQ.L3m2Ue3OOucOI3XrhwjUIQ';
                    var map = new mapboxgl.Map({
                        container: 'map', // container id
                        style: 'mapbox://styles/mapbox/satellite-v9', //stylesheet location
                        center: [start_coordinates[0],start_coordinates[1]], // starting position longitude followed by latitude
                        zoom: 18 // starting zoom
                    });


    map.on('load', function () {
        var i = 0; 
        var iter = 0;
        var coordinate =0;
        var outer_loop = 0;
        var id_value =0;
        
        while(outer_loop != coordinate_array.length)
        var individual_coordinates = []
        var all_coordinates =[]
        
       /* while(outer_loop != coordinate_array.length)
            {
                
                var temp = coordinate_array[outer_loop];
                var separated_coordinates = Object.values(temp);
                if(separated_coordinates.length > 1)
                    {
                       

                                    id_value= id_value = parseInt(Math.floor((Math.random() * 10000) + 1)).toString();

                                    map.addLayer({
                                        "id": id_value,
                                        "type": "symbol",
                                        "source": {
                                            "type": "geojson",
                                            "data": {
                                                "type": "FeatureCollection",
                                                "features": [{
                                                    "type": "Feature",
                                                    "geometry": {
                                                        "type": "Point",
                                                        "cluster":true,
                                                        "coordinates": [parseFloat(separated_coordinates[i]),parseFloat(separated_coordinates[i+1])]
                                                    },
                                                    "properties": {
                                                        "title": separated_coordinates[i+2],
                                                        "icon": "dog-park"


                                    id_value= id_value = parseInt(Math.floor((Math.random() * 10000) + 1)).toString();

                                    /*map.addLayer({
                                        "id": id_value,
                                        "type": "symbol",
                                        "source": {
                                            "type": "geojson",
                                            "data": {
                                                "type": "FeatureCollection",
                                                "features": [{
                                                    "type": "Feature",
                                                    "geometry": {
                                                        "type": "Point",
                                                        "cluster":true,
                                                        "coordinates": [parseFloat(separated_coordinates[i]),parseFloat(separated_coordinates[i+1])]
                                                    },
                                                    "properties": {
                                                        "title": separated_coordinates[i+2],
                                                        "icon": "dog-park"

                                                    }
                                                }]
                                            }
                                        },
                                        "layout": {
                                            "icon-image": "{icon}-15",
                                            "text-field": "{title}",
                                            "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],
                                            "text-offset": [0, 0.6],
                                            "text-anchor": "top"
                                        }
                                    });

                                        id_value = 0;
                    }
            outer_loop = outer_loop + 1;
                    
            console.log("outerloop: " + outer_loop);       
        }
         

        }*/
        
        
        
        /*console.log("coordinate_array[0]:" + coordinate_array[0]);
        console.log("coordinate_array[1]:" + coordinate_array[1]);
        console.log("coordinate_array[2]:" + coordinate_array[2]);
        console.log("coordinate_array[3]:" + coordinate_array[3]);
        console.log("coordinate_array[4]:" + coordinate_array[4]);
        console.log("coordinate_array[5]:" + coordinate_array[5]);*/
        while(outer_loop != coordinate_array.length)
            {
                var temp = coordinate_array[outer_loop];
                var separated_coordinates = Object.values(temp);
                if(separated_coordinates.length > 1)
                    {
                        individual_coordinates.push(separated_coordinates[0],separated_coordinates[1]);
                        all_coordinates.push(individual_coordinates);
                        individual_coordinates =[];
                    }
            
                outer_loop = outer_loop+1;
            }

        
        while(iter < all_coordinates.length -1)
            {       

                       id_value = parseInt(Math.floor((Math.random() * 100000) + 1)).toString();
                        console.log(id_value);
                                map.addLayer({
                                        "id": id_value,
                                        "type": "line",
                                        "source": {
                                            "type": "geojson",
                                            "data": {
                                                "type": "Feature",
                                                "properties": {},
                                                "geometry": {
                                                    "type": "LineString",
                                                    "coordinates":all_coordinates
                                                }
                                            }
                                        },
                                        "layout": {
                                            "line-join": "round",
                                            "line-cap": "round"
                                        },
                                        "paint": {
                                            "line-color": "#500",
                                            "line-width": 8
                                        }
                                    });
                        
                            
                id_value = 0;
                iter = iter+ 1;
                coordinate = iter;
                console.log("iter: " + iter);
                console.log("coordinate: " + coordinate);
                break;
                
            }
     
    });
    
                   
                    
                   
                   
                </script>
          
        </div>    
    </body>
</html>